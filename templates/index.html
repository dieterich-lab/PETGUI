<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Required meta tags-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="Colorlib Templates">
    <meta name="author" content="Colorlib">
    <meta name="keywords" content="Colorlib Templates">
    <script src="/static/js/bootstrap.bundle.min.js"></script>


    <!-- Title Page-->
    <title>PET APP</title>

    <!-- Icons font CSS-->
    <link href="/static/vendor/mdi-font/css/material-design-iconic-font.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/font-awesome-4.7/css/font-awesome.min.css" rel="stylesheet" media="all">
    <!-- Font special for pages-->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">

    <!-- Vendor CSS-->
    <link href="/static/vendor/select2/select2.min.css" rel="stylesheet" media="all">
    <link href="/static/vendor/datepicker/daterangepicker.css" rel="stylesheet" media="all">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">

    <!-- Main CSS-->
    <link href="/static/css/main.css" rel="stylesheet" media="all">


</head>

<body>
    <div class="page-wrapper bg-gra-03 p-t-45 p-b-50">
        <div class="wrapper wrapper--w790">
            <div class="card card-5">
                <div class="card-heading">
                    <h2 class="title">PET APP</h2>
                </div>
                <script>
var counter = 1;
var dynamicInput = [];

function addInput(){
    var newdiv = document.createElement('div');
    newdiv.id = dynamicInput[counter];
    newdiv.innerHTML = "Template " + (counter + 1) + " <br><input class='input--style-5 form-control' type='text' placeholder='Please enter the template text' name = template_"+counter +" required> <br><input class='btn btn--radius-2 btn--red' type='button' value='-' onClick='removeInput("+dynamicInput[counter]+");'>";
    document.getElementById('formulario').appendChild(newdiv);
    counter++;
}

  function removeInput(id){
    var elem = document.getElementById(id);
    return elem.parentNode.removeChild(elem);
  }
</script>



                 <script>
var counter_map = 1;
var dynamicInput = [];

function addInput_map(){
    var newdiv = document.createElement('div');
    newdiv.id = dynamicInput[counter_map];
    newdiv.innerHTML = "Mapping " + (counter_map + 1) + " <div class='row row-space'><div class='col-2'><div class='input-group'><input class='input--style-5 form-control' type='text' placeholder='origin' name=origin_"+ counter_map +" required></div></div><div class='col-2'><div class='input-group'><input class='input--style-5 form-control' type='text' placeholder='mapping' name=mapping_"+counter_map+" required><input class='btn btn--radius-2 btn--red' type='button' value='-' onClick='removeInput("+dynamicInput[counter]+");'></div></div></div>";
    document.getElementById('formularmap').appendChild(newdiv);
    counter++;
}

  function removeInput(id){
    var elem = document.getElementById(id);
    return elem.parentNode.removeChild(elem);
  }
</script>
                <div class="card-body">
                    <form method="POST" enctype="multipart/form-data" >
                       <label for="file">Upload csv data in a zip file. The uploaded zip file contains the train and test dataset in csv format and a readme file</label><br>
                        <input type="file" id="file-uploader" name = "file" required>
                        <p id="feedback"></p>
                        <div id="statistics"></div>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.11/pako.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.13.1/underscore-min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script>
  const fileUploader = document.getElementById('file-uploader');
fileUploader.addEventListener('change', (event) => {
    const files = event.target.files;
    console.log('files', files);
    const feedback = document.getElementById('feedback');
    const fileExt = files[0].name.split('.').pop(); // Get the file extension
    if (fileExt !== 'gz') { // Check if file is not a tar.gz file
        feedback.innerHTML = `Error: ${fileExt} file type not supported!`;
        return;
    }
    const msg = `File ${files[0].name} uploaded successfully!`;
    feedback.innerHTML = msg;

        const fileReader = new FileReader();
        fileReader.onload = () => {
          const gzip = new Zlib.Gunzip(new Uint8Array(fileReader.result));
          const tar = Tar.parse(gzip.decompress());
          const trainCsv = tar.entries['train.csv'];
          Papa.parse(trainCsv.buffer, {
            header: true,
            download: false,
            skipEmptyLines: true,
            complete: function (results) {
              const data = results.data;
              const labels = new Set();
              const labelCounts = {};

              // Collect label statistics
              data.forEach((row) => {
                const label = row.label;
                labels.add(label);
                if (!labelCounts[label]) {
                  labelCounts[label] = 0;
                }
                labelCounts[label]++;
              });

              // Render label statistics on the webpage
              const numLabels = labels.size;
              let labelStats = `<p>Number of labels: ${numLabels}</p>`;
              labels.forEach((label) => {
                const count = labelCounts[label];
                labelStats += `<p>Label ${label}: ${count} samples</p>`;
              });
              const statistics = document.getElementById('statistics');
              statistics.innerHTML = labelStats;
            },
            error: function (error) {
              console.error(error);
            }
          });
        };
        fileReader.readAsArrayBuffer(files[0]);
      });
    </script>

                        <div class="form-row m-b-55">
                            <div class="name">Define columns numbers:</div>
                            <div class="value">
                                <div class="row row-space">
                                    <div class="col-2">
                                        <div class="input-group-desc">
                                            <input class="input--style-5 form-control" type="number" placeholder="Sample" name="sample" required>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="input-group-desc">
                                            <input class="input--style-5 form-control" type="number" placeholder ="Label" name="label" required>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row"id="formulario">
                            <div class="name">Define templates:</div>
                            <div class="value">
                                <div id="dynamicInput[0]">
                                <div class="input-group" >
                                    <input class="input--style-5 form-control" type="text" placeholder = "Template text here.Example:It was_." name="template_0"  required>
                                    <button class="btn btn--radius-2 btn--red"  type ="button" onClick="addInput();">+</button><br>
                                    </div>
                                    </div>
                                </div>
                            </div>

                   <div class="form-row m-b-55">
                            <div class="name">Define verbalizer mapping (label: mapping):</div>
                            <div class="value">
                                <div class="row row-space" id = 'formularmap' >
                                    <div class="col-2">
                                        <div class="input-group" >
                                            <input class="input--style-5 form-control" type="text" placeholder="origin" name="origin_0" required>
                                        </div>
                                    </div>
                                    <div class="col-2">
                                        <div class="input-group">
                                            <input class="input--style-5 form-control" type="text" placeholder="mapping" name="mapping_0" required>
                                            <button class="btn btn--radius-2 btn--red"  type ="button" onClick="addInput_map();">+</button><br>

                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="form-row p-t-20">
                            <label class="label label--block">Define your language model:</label>
                            <div class="p-t-15">
                                <label class="radio-container m-r-55">gbert-base
                                    <input type="radio" checked="checked" name="model_para" value="gbert-base" required>
                                    <span class="checkmark"></span>
                                </label>
                                <label class="radio-container">gbert-base-clinical
                                    <input type="radio" name="model_para" value="gbert-base-clinicalL" required>
                                    <span class="checkmark"></span>
                                </label>
                            </div>
                        </div>
                        <button class="btn btn--radius-2 btn--red" type="submit">Send</button><br><br>
                    </form>
                </div>
            </div>
            </div>
        </div>


    <!-- Jquery JS-->
    <script src="/static/vendor/jquery/jquery.min.js"></script>
    <!-- Vendor JS-->
    <script src="/static/vendor/select2/select2.min.js"></script>
    <script src="/static/vendor/datepicker/moment.min.js"></script>
    <script src="/static/vendor/datepicker/daterangepicker.js"></script>

    <!-- Main JS-->
    <script src="/static/js/global.js"></script>

</body><!-- This templates was made by Colorlib (https://colorlib.com) -->

</html>
<!-- end document-->